<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Présentation de différents outils de provisionning</title>

		<meta name="description" content="Présentation de différents outils de provisionning">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Outils de provisionning</h1>
					<h3>Ansible, Chef et Puppet</h3>
					<p>
						<small>Julien Bianchi, Haikel Guemar et Michael Scherer</small>
					</p>
				</section>

				<section>
					<h2>Hello!</h2>

                    <div class="fragment" style="float: left; width: 20%; margin: 0 2.5%">
                        <img src="images/misc.png" style="width: 100%"/>
                        <h3>Michael Scherer</h3>
                        <h4>Ansible</h4>
                    </div>

                    <div class="fragment" style="float: left; width: 20%; margin: 0 2.5%">
                        <img src="images/nyantocat.png" style="width: 100%"/>
                        <h3>Julien Bianchi</h3>
                        <h4>Chef</h4>
                    </div>

                    <div class="fragment" style="float: left; width: 20%; margin: 0 2.5%">
                        <img src="images/benoit.png" style="width: 100%"/>
                        <h3>Benoît Marcelin</h3>
                        <h4>Puppet</h4>
                    </div>

                    <div class="fragment" style="float: left; width: 20%; margin: 0 2.5%">
                        <img src="images/tonthon.jpeg" style="width: 100%"/>
                        <h3>Gaston Tjebbes </h3>
                        <h4>Salt</h4>
                    </div>
				</section>

                <section>
                    <section>
                        <h2>Provisionning</h2>
                    </section>

                    <section>
                        <h2>C'est quoi ?</h2>

                        <blockquote>
                            “Le provisioning, mot anglais désignant l'approvisionnement, est un terme utilisé dans le monde de l'informatique,
                            désignant l'allocation automatique de ressources.
                            <br/>
                            Les outils de provisioning sont des outils de <strong>gestion de configuration</strong> (on parle également de «gestion de
                            paramétrage») permettant d'<strong>installer et de configurer des logiciels à distance</strong>...”
                        </blockquote>

                        <p><small><a href="http://fr.wikipedia.org/wiki/Provisioning">http://fr.wikipedia.org/wiki/Provisioning</a></small></p>
                    </section>

                    <section>
                        <h2>Pourquoi ?</h2>

                        <ul>
                            <li>Pour <strong>décrire les procédures</strong> d'installation et de configuration</li>
                            <li>Pour installer/configurer des applications <strong>de manière automatique</strong></li>
                            <li>Pour installer/configurer des applications <strong>à distance</strong></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Comment ?</h2>

                        <ul>
                            <li><strong>Ansible</strong></li>
                            <li><strong>Chef</strong></li>
                            <li><strong>Puppet</strong></li>
                            <li><strong>Salt</strong></li>
                            <li>CFEngine</li>
                            <li>Docker (builder)</li>
                            <li>...</li>
                        </ul>
                    </section>
                </section>

				<section>
					<section>
						<h2>Ansible</h2>
						<p>
							Radically simple IT<br/>automation platform
						</p>
					</section>

					<section>
						<h2>En résumé</h2>
						<p>Python, GPL v3</p>
					</section>

					<section>
						<h2>Exeécution de tâches<br/>sur des serveurs</h2>
						<p>via ssh</p>
					</section>

					<section>
						<h2>Commandes ad-hoc</h2>
						<pre><code>ansible prod -m shell -a "yum upgrade -y"</code></pre>
					</section>
					<section>
						<h2>Playbook</h2>
						<p>YAML + des bouts de Jinja</p>
					</section>
					<section>
						<h2>Orchestration</h2>
						<p>
<pre><code>---
- hosts: jboss_servers
  serial: 10%
  tasks:
  - nagios: action=disable_alerts service=host host={{ inventory_hostname }}
    delegate_to: 127.0.0.1

  - shell: yum upgrade -y

  - shell: reboot

  - wait_for: port=80 delay=10 host={{ inventory_hostname }}
    delegate_to: 127.0.0.1

  - nagios: action=enable_alerts service=host host={{ inventory_hostname }}
    delegate_to: 127.0.0.1
						</code></pre>
						</p>
					</section>
					<section>
						<h2>Gestion de configuration</h2>
						<pre><code>---
- hosts: web_servers
  roles:
  - role: website
    url: www.example.org
    document_root: /srv/sites/www/

  - role: website
    url: webmail.example.org
    document_root: /srv/sites/webmail/
    modules:
    - php

  - role: website
    url: calendar.example.org
    redirect: webmail.example.org
						</code></pre>
					</section>

					<section>
						<h2>Avec plus de details</h2>
					</section>

					<section>
						<h2>Modules</h2>
						<p>Idempotents</p>
						<p>Couvrent de nombreux besoins</p>
					</section>

					<section>
						<h2>Inventaire</h2>
						<ul><li>Fichier plat</li>
						<li>Dossier</li>
						<li>Script</li></ul>
					</section>

					<section>
						<pre><code>
[web_servers]
www[1,5].example.org ansible_ssh_user=root

[redis_servers]
redis[1,3].example.org ansible_ssh_user=centos ansible_sudo=yes
redis-test.example.org ansible_ssh_user=fedora ansible_sudo=yes
						</code></pre>
					</section>
					<section>
						<h2>Variables</h2>
						<p>Utilisables en Jinja</p>
					</section>
					<section>
						<h2>Dans le playbook</h2>
						<pre><code>---
- hosts: webbuilder
  vars:
    builder_user: builder_middleman
    error_mail:   misc@example.org
  roles:
  - role: builder
    name: manageiq
    git_url: "https://git.example.com/example/website.git"
    git_version: master
    remote_location: /var/www/html
    remote_server: www.example.org
    remote_user: root
						</code></pre>
					</section>
					<section>
						<h2>Fournies par Ansible</h2>
						<pre><code>$ ansible all -m setup -c local -i '127.0.0.1,'
127.0.0.1 | success >> {
    "ansible_facts": {
        "ansible_all_ipv4_addresses": [
            "192.168.76.131"
        ],
        "ansible_all_ipv6_addresses": [
            "fe80::ea2a:eaff:fe15:9d20"
        ],
        "ansible_architecture": "x86_64",
        "ansible_bios_date": "03/28/2014",
        "ansible_bios_version": "CJFT85RW (2.24 )",
        "ansible_cmdline": {
            "BOOT_IMAGE": "/vmlinuz-3.10.0-210.el7.x86_64",
            "LANG": "fr_FR.UTF-8",
						</code></pre>
					</section>
					<section>
						<h2>Stocké dans des fichiers à part</h2>
						<pre><code>$ ls *
deploy.yml    hosts    requirements.yml

group_vars:
webservers.yml    redis_servers.yml

host_vars:
redis-test.yml

roles:
builder    website    redis
						</code></pre>
					</section>
					<section>
						<h2>Anatomie d'un rôle</h2>
						<pre><code>$ ls roles/builder/*
roles/builder/defaults:
mail.yml

roles/builder/files:
builder.sh

roles/builder/handlers:
mail.yml

roles/builder/meta:
main.yml

roles/builder/tasks:
main.yml

roles/builder/templates:
config.ini
						</code></pre>
					</section>
					<section>
						<h2>Structure de contrôle</h2>
						<ul><li>when</li>
						<li>with_items</li>
						<li>register</li></ul>
					</section>
					<section>
						<h2>When</h2>
						<pre><code>
- name: install Epel
  yum: pkg=epel-release state=installed
  when: ansible_distribution == 'CentOS'
						</code></pre>
					</section>
					<section>
						<h2>With_items</h2>
						<pre><code>
- name: install base rpms
  yum: pkg={{ item }} state=installed
  with_items:
  - screen
  - htop
  - iftop
  - iotop
  - strace
  - vim-enhanced
  - tcpdump
  - chrony
						</code></pre>
					</section>

					<section>
						<h2>Register</h2>
						<pre><code>
- user:
   name=builder_middleman
   generate_ssh_key=yes
  register: result

- authorized_key:
      key="{{ result.ssh_public_key }}"
      user=copy_user
  delegate_to: www.example.org
						</code></pre>
					</section>
					<section>
						<h2>Plus d'informations</h2>
						<p>http://www.ansible.com/</p>
						<p>#ansible sur Freenode</p>
						<p>ansible-users sur Google groups</p>
					</section>
				</section>


				<section>
					<section data-background="images/chef/logo.png" data-background-size="40%" data-background-transition="zoom">
						<h2>OpsCode Chef</h2>
						<p>
						</p>
					</section>

					<section>
						<h2>Chef, c'est quoi donc ?</h2>
						<blockquote cite="https://docs.chef.io/">
                            “Chef is a systems and cloud <strong>infrastructure automation framework</strong> that makes it easy to deploy servers and applications to any physical, virtual, or cloud location, no matter the size of the infrastructure.”
						</blockquote>

                        <p><small><a href="http://docs.chef.io/">http://docs.chef.io</a></small></p>
					</section>

                    <section>
                        <h2>Un framework</h2>

                        <h3>Un cadre</h3>
                        <h3>Des conventions</h3>
                        <h3>Des outils</h3>
                    </section>

                    <section>
                        <h2>Un peu de vocabulaire</h2>
                        <table>
                            <tbody>
                                <tr>
                                    <td>Cookbooks</td>
                                    <td></td>
                                </tr>
                                <tr></tr>
                                <tr>
                                    <td>Recettes (recipes)</td>
                                    <td></td>
                                </tr>
                                <tr></tr>
                                <tr>
                                    <td>Ressources</td>
                                    <td></td>
                                </tr>
                                <tr></tr>
                                <tr>
                                    <td>Attributs (attributes)</td>
                                    <td></td>
                                </tr>
                                <tr></tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>Attributs</h2>

                        <blockquote cite="https://docs.chef.io/">
                            “An attribute is a specific detail about a node”
                        </blockquote>

                        <p><small><a href="http://docs.chef.io/cookbooks.html">http://docs.chef.io/attributes.html</a></small></p>

                        <p>En gros, c'est une variable configurable et/ou dépendante de la plateforme.</p>
                    </section>

                    <section>
                        <h2>Attributs</h2>

                        <h3>Défini par</h3>
                        <pre class="ruby"><code data-trim># my_app/attributes/default.rb

default['my_app']['environment'] = 'prod'</code></pre>

                        <h3>Accédé par</h3>

                        <pre class="ruby"><code data-trim># my_app/recipes/default.rb

puts node['my_app']['environment']</code></pre>
                    </section>

                    <section>
                        <h2>Ressource</h2>

                        <blockquote>
                            “A resource is a statement of configuration policy. It describes the desired state of an element of your infrastructure, along with the steps needed to bring that item to the desired state.”
                        </blockquote>

                        <p><small><a href="http://docs.chef.io/resources.html">http://docs.chef.io/resources.html</a></small></p>
                    </section>

                    <section>
                        <h2>Ressource</h2>

                        <pre class="ruby"><code data-trim># my_app/recipes/packages.rb

package 'hhvm' do
    action :install
end</code></pre>

                        <blockquote cite="https://docs.chef.io/">
                            “Chef, installe le paquet <code>hhvm</code> s'il n'est pas déjà installé.
                            <br/>
                            Merci !”
                        </blockquote>
                    </section>

                    <section>
                        <h2>Ressources</h2>

                        <h3>50+ ressources natives</h3>
                        <h4>file, directory, execute, package, ruby_block, service, user, group, ...</h4>
                        <p><small><a href="http://docs.chef.io/resources.html#platform-resources">http://docs.chef.io/resources.html#platform-resources</a></small></p>
                    </section>

                    <section>
                        <h2>Recette (recipe)</h2>

                        <blockquote>
                            “A recipe is the most fundamental configuration element within the organization.“
                        </blockquote>

                        <p><small><a href="http://docs.chef.io/recipes.html">http://docs.chef.io/recipes.html</a></small></p>
                    </section>

                    <section>
                        <h2>Recette (recipe)</h2>
                        <p>Une recette contient une ou plusieurs ressources</p>

                        <pre class="ruby"><code data-trim># recipes/packages.rb

yum_repository 'epel' do
    mirrorlist 'http://mirrors.fedoraproject.org/mirrorlist?repo=epel-5&arch=$basearch'
    gpgkey 'http://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6'
    action :create

    notifies :run, 'execute[yum-clean-all]', :immediately
end

execute 'yum-clean-all' do
    command 'yum clean all'
    action :nothing
end

package 'php'</code></pre>

                        <blockquote cite="https://docs.chef.io/">
                            “Chef, pour installer le paquet <code>php</code>, il faut commencer par ajouter le dépôt EPEL. Ensuite tu pourras installer <code>php</code>”
                        </blockquote>
                    </section>

                    <section>
                        <h2>Cookbook</h2>

                        <blockquote cite="https://docs.chef.io/">
                            “A cookbook is the fundamental unit of configuration and policy <strong>distribution</strong>. Each cookbook defines a scenario, such as everything needed to install and configure MySQL”
                        </blockquote>

                        <p><small><a href="http://docs.chef.io/cookbooks.html">http://docs.chef.io/cookbooks.html</a></small></p>
                    </section>

                    <section>
                        <h2>Cookbook</h2>

                        <pre><code data-trim>.
├── attributes/
│   └── default.rb
├── files/
│   └── default/
├── libraries/
├── metadata.rb
├── providers/
├── recipes/
│   ├── default.rb
│   └── packages.rb
├── resources/
└── templates/
    └── default/</code></pre>
                    </section>

                    <section>
                        <h2>Et c'est pas fini !</h2>

                        <ul>
                            <li>Databags</li>
                            <li>Providers</li>
                            <li>Portabilité (<code>value_for_platform</code>, ohai)</li>
                            <li>Notifications (<code>notifies</code>) et Abonnements (<code>subscribes</code>)</li>
                            <li>Gardes (<code>only_if</code>, <code>not_if</code>)</li>
                            <li>Surcharges d'attributs</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Configuration</h2>
                        <p>Un peu de JSON</p>

                        <pre class="json"><code data-trim>{
    "run_list": [
        "recipe[etc_environment]",
        "recipe[my_app::packages]",
        "recipe[my_app]"
    ],
    "etc_environment": {
        "SYMFONY_ENV": "prod",
        "SYMFONY_DEBUG": 0
    }
}</code></pre>

                        <p>La liste des recettes (<code>run_list</code>) à exécuter ainsi que les attributs</p>
                    </section>

                    <section>
                        <h2>chef-solo</h2>
                        <p>Pour le mode standalone</p>

                        <pre class="ruby"><code data-trim># /opt/chef/solo.rb

cookbook_path ['/opt/chef/cookbooks']
json_attribs '/opt/chef/solo.json'</code></pre>

                        <pre><code data-trim>$ chef-solo -c /opt/chef/solo.rb</code></pre>
                    </section>

                    <section>
                        <h2>Exécution (run)</h2>

                        <pre class="stretch"><code data-trim>Starting Chef Client, version 11.12.8
resolving cookbooks for run list: ["ohai", "proxmox-ohai", "resolver", "timezone", "consul", ...]
Synchronizing Cookbooks:
- ohai
- proxmox-ohai
- resolver
- timezone
- consul
...
Compiling Cookbooks...
Converging 26 resources
Recipe resolver::default
  * template[/etc/resolv.conf] action create (up to date)
Recipe timezone::default
  * package[tzdata] action install (up to date)
  * template[/etc/timezone] action create (up to date)
  * bash[dpkg-reconfigure tzdata] action nothing (skipped due to action :nothing)
Recipe consul::default
...
Chef Client finished, 2/31 resources updated in 3.391670365 seconds</code></pre>
                    </section>

                    <section>
                        <h2>Exécution (run)</h2>

                        <h3>Plusieurs étapes</h3>
                        <ul>
                            <li>Calcul de la configuration du noeud</li>
                            <li>Résolution de la <code>run_list</code></li>
                            <li><strong>Compilation des ressources</strong></li>
                            <li><strong>Convergence</strong></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Compilation / Convergence</h2>

                        <h3>Recette</h3>
                        <pre class="ruby"><code data-trim># my_app/recipes/default.rb

# Une fonction Ruby
puts 'Yo'

# Une ressource Chef
log 'Man'

puts 'Hello'
log 'World'</code></pre>

                        <div class="fragment">
                            <h3>Résultat</h3>

                            <pre><code data-trim>Yo
Hello
[2015-01-22T20:51:04+00:00] INFO: Man
[2015-01-22T20:51:04+00:00] INFO:World
</code></pre>
                        </div>
                    </section>

                    <section>
                        <h2>Chef Server &amp; chef-client</h2>
                        <p>Pour le mode client/serveur</p>

                        <pre class="ruby"><code data-trim>chef_server_url  "https://chef.myorg.com"
validation_client_name "chef-validator"
node_name "my_app_web"
environment "production"</code></pre>

                        <pre><code data-trim>$ chef-client</code></pre>
                    </section>

                    <section>
                        <h2>Un peu de vocabulaire, encore</h2>
                        <table>
                            <tbody>
                                <tr>
                                    <td>Noeuds (nodes)</td>
                                    <td>Le système cible décrit par des rôles, des cookbooks/recettes et des attributs</td>
                                </tr>
                                <tr></tr>
                                <tr>
                                    <td>Rôles</td>
                                    <td>Une collection de cookbooks/recettes et des attributs</td>
                                </tr>
                                <tr></tr>
                                <tr>
                                    <td>Environnements</td>
                                    <td>Un ensemble de contraintes sur les cookbooks et des attributs</td>
                                </tr>
                                <tr></tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>Chef Server</h2>

                        <ul>
                            <li>Héberge les cookbooks</li>
                            <li>Héberge les configurations (noeuds, rôles, environnements et databags)</li>
                            <li>Authentifie les tiers</li>
                            <li>Maintient un index des données</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Orchestration</h2>

                        <p>Grâce à l'index <code>:node</code> et à la méthode <code>search</code>.</p>

                        <pre class="ruby"><code data-trim>search(:node, "role:db",
    :filter_result => { 'ip' => [ 'ipaddress' ]}).each do |result|
    puts result['ip']
end

                        </code></pre>
                    </section>

                    <section>
                        <h2>L'écosystème</h2>

                        <ul>
                            <li>Des outils</li>
                            <li>Des cookbooks libres</li>
                            <li>Des patterns</li>
                            <li>Une communauté</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Les outils</h2>
                        <table>
                            <tbody>
                            <tr>
                                <td>knife</td>
                                <td>Commande pour gérer chef server</td>
                            </tr>
                            <tr></tr>
                            <tr>
                                <td>berks</td>
                                <td>Gestionnaire de dépendances</td>
                            </tr>
                            <tr></tr>
                            <tr>
                                <td>foodcritic</td>
                                <td>Linter</td>
                            </tr>
                            <tr></tr>
                            <tr>
                                <td>chefspec</td>
                                <td>Tests unitaires</td>
                            </tr>
                            <tr></tr>
                            <tr>
                                <td>kitchen CI</td>
                                <td>Tests d'intégration multi-plateforme</td>
                            </tr>
                            <tr></tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>Place to be #1</h2>

                        <h3>Documentation</h3>
                        <p>Dépôt central des cookbooks communautaires</p>

                        <p><small><a href="http://docs.chef.io">http://docs.chef.io</a></small></p>
                    </section>

                    <section>
                        <h2>Documentation</h2>

                        <h3>Le lien magique</h3>
                        <p>https://docs.chef.io/resource_&lt;resource-name&gt;.html</p>
                        <br/>
                        <h3>La liste des ressources</h3>
                        <p><a href="https://docs.chef.io/resources.html#platform-resources">https://docs.chef.io/resources.html#platform-resources</a></p>
                    </section>

                    <section>
                        <h2>Place to be #2</h2>

                        <h3>Supermarket</h3>
                        <p>Dépôt central des cookbooks communautaires</p>

                        <p><small><a href="https://supermarket.chef.io">https://supermarket.chef.io</a></small></p>
                    </section>

                    <section>
                        <h2>Place to be #3</h2>

                        <h3>Github</h3>
                        <p>Code source des cookbooks communautaires</p>

                        <p>
                            <small><a href="https://github.com/opscode-cookbooks">https://github.com/opscode-cookbooks</a></small><br/>
                            <small><a href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a></small>
                        </p>
                    </section>

                    <section>
                        <h2>Les points forts</h2>

                        <ul>
                            <li>Du ruby partout</li>
                            <li>Une documentation assez énorme</li>
                            <li>Beaucoup de ressources (cookbooks, articles, ...)</li>
                            <li>Un DSL puissant et extensible</li>
                            <li>Un très bon écosystème</li>
                            <li>Une communauté très active</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Les points faibles</h2>

                        <ul>
                            <li>Les débuts peuvent être compliqués</li>
                            <li>La documentation est parfois dure à exploiter</li>
                            <li>Chef server un peu compliqué à installer</li>
                            <li>Manque de qualité de certains cookbooks communautaires</li>
                        </ul>
                    </section>

				</section>

				<section>
                    <section data-background="images/puppet/logo.svg"
                        data-background-position="50%"
                        data-background-size="60%"
                        data-background-transition="zoom"></section>
					<section>
						<h2>Ça fait quoi ?</h2>
						<p>À partir d’un jeu de règles</p>
                        <ul>
                            <li class="fragment">Le master génère un catalogue
                            décrivant l’état cible</li>
                            <li class="fragment">Le catalogue est envoyé sur la
                            cible</li>
                            <li class="fragment">L’agent vérifie pour chaque
                            élément du catalogue si c’est l’état actuel, le cas
                            échéant il change l’état</li>
                            <li class="fragment">Un rapport est renvoyé au
                            master</li>
                        </ul>
                        <aside class="notes">
                            <p>On peut aussi générer le catalogue depuis les cibles à condition de tout dupliquer.</p>
                        </aside>
					</section>
                    <section>
                        <h2>Exemple simple</h2>
                        <pre><code>node default {
    service { 'sshd':
        enable  =&gt; true,
    }
    package { 'sshd':
        ensure  =&gt; latest,
        name    =&gt; 'openssh-server',
    }
    file { '/etc/ssh/sshd_config':
        file    =&gt; 'puppet:///files/sshd_config',
        notify  =&gt; Service['sshd'],
        require =&gt; Package['sshd'],
    }
}</code></pre>
                        <a class="fragment"  href="https://docs.puppetlabs.com/references/latest/type.html">Liste exhaustive des types natifs supportés.</a>
                    </section>
                    <section>
                        <h2>Différence entre “type” et “class”</h2>
                        <h3>Déclaration d’un type de ressource</h3>
                        <pre><code>define monmodule::montype (
    $variable1 = 'valeur par défaut',
    $variable2,
    ) {
    file { "/etc/httpd/conf.d/${variable1}":
        content =&gt; $variable2,
    }
}</code></pre>
                        <div class="fragment">
                            <h3>Déclaration d’une classe</h3>
                            <pre><code>class monmodule::maclasse (
    $variable1 = 'valeur par défaut',
    $variable2,
    ) {
    package { 'httpd': }
    service { 'httpd': }
    file { '/etc/httpd/httpd.conf':
        content =&gt; template('monmodule/httpd.conf.erb'),
        notify  =&gt; Service['httpd'],
    }
    monmodule::montype { 'default':
        variable2 =&gt; '',
    }
}</code></pre>
                        </div>
                    </section>
                    <section>
                        <h2>Comment charger une classe</h2>
                        <p>Deux manières : <span class="fragment">la bonne</span> et <span class="fragment">la mauvaise</span></p>
                        <div class="fragment">
                            <h3>La bonne</h3>
                            <pre><code>include monmodule::maclasse</code></pre>
                        </div>
                        <div class="fragment">
                            <h3>La mauvaise</h3>
                            <pre><code>class { monmodule::maclasse: }</code></pre>
                            <pre class="fragment"><code>class { monmodule::maclasse:
    variable1 =&gt; 'valeur',
}</code></pre>
                            <p class="fragment">À la place on met les variables de classe dans hiera.</p>
                        </div>
                    </section>
                    <section>
                        <h2>Arborescence</h2>
                        <pre><code>/etc/puppet
├── auth.conf
├── environments
│   └── production
│       ├── manifests
│       │   └── site.pp
│       └── modules
├── fileserver.conf &lt;!-- Utilisé par les requêtes puppet://[serveur]/loc --&gt;
├── hiera.yaml      &lt;!-- Configuration de l’entrepôt de variables --&gt;
├── manifests
│   └── site.pp
├── modules
├── puppet.conf
│   &lt;!-- Mes recommandations --&gt;
├── hieradata
└── sensitive</code></pre>
                        <p>/etc/puppet/fileserver.conf
                        <pre><code>[sensitive]
path /etc/puppet/sensitive/%d/%h
allow *</code></pre>
                    </section>
                    <section>
                        <h2>Hiera</h2>
                        <p>hierdata/</p>
                        <pre><code>├── common.yaml
├── developement.yaml
├── afpy.org.yaml
├── integration.yaml
└── server1.afpy.org.yaml</code></pre>
                        <p>common.yaml
                        <pre><code>---
nginx::confd_purge: true
postgresql::globals::encoding: 'UTF-8'
default_vhost_name: "%{fqdn}"
root_keys:
    - user1
jvm_properties:
    Xmx: 5g
</code></pre>
                        <p>Les fonctions</p>
                        <pre><code>hiera('key', 'default', 'override')
hiera_array('key', 'default', 'override')
hiera_hash('key', 'default', 'override')</code></pre>
                        <aside class="notes">Override sert pour redéfinir la hiérarchie de hiera.</aside>
                    </section>
                    <section>
                        <h2>Facter</h2>
                        <p>Permet de récupérer des informations à propos de nœuds.</p>
                        <pre><code>architecture =&gt; x86_64
bios_version =&gt; MWPNT10N.86A.0083.2011.0524.1600
blockdevice_sda_model =&gt; TOSHIBA DT01ACA1
blockdevice_sda_size =&gt; 1000204886016
blockdevices =&gt; sda sdb sdc
domain =&gt; afpy.org
fqdn =&gt; exemple1.afpy.org
hostname =&gt; exemple1
interfaces =&gt; br0,eth0,lo,virbr0,virbr0_nic
ipaddress =&gt; 10.10.12.12
ipaddress6_br0 =&gt; 2001::1
is_virtual =&gt; false
kernel =&gt; Linux
kernelmajversion =&gt; 3.10
memoryfree =&gt; 2.85 GB
memorysize_mb =&gt; 3775.95
operatingsystem =&gt; CentOS
operatingsystemmajrelease =&gt; 7
os =&gt; {"name"=&gt;"CentOS", "family"=&gt;"RedHat", "release"=&gt;{"major"=&gt;"7", "minor"=&gt;"0", "full"=&gt;"7.0.1406"}}
osfamily =&gt; RedHat
partitions =&gt; {"sda1"=&gt;{"uuid"=&gt;"aa6f8f14-9e42-495d-8b1b-2a17849494d0", "size"=&gt;"40957952", "mount"=&gt;"/", "filesystem"=&gt;"ext3"}, "sda2"=&gt;{"uuid"=&gt;"5bca139c-67a4-416c-8d6d-b2eda0404b64", "size"=&gt;"1046528", "filesystem"=&gt;"swap"}}
processorcount =&gt; 2
selinux =&gt; true
virtual =&gt; physical
</code></pre>
                    </section>
                    <section>
                        <h2>PuppetDB</h2>
                        <ul>
                            <li>Base de données</li>
                            <li class="fragment">Facts</li>
                            <li class="fragment">Catalogues</li>
                        </ul>
                        <div class="fragment">
                            <p>Ressources exportées</p>
                            <pre><code>@@dns::record::aaaa { 'wsgi':
    data =&gt; $::ipaddress6,
    zone =&gt; $::domain,
}</code></pre>
                            <pre><code>Dns::Record:Aaaa &lt;&lt;| zone == $::domain |&gt;&gt; </code></pre>
                        </div>
                    </section>
                    <section>
                        <h2>Anatomie d’un module</h2>
                        <pre><code>modules/monmodule/
├── files
│   └── sshd_config
├── lib
│   ├── facter
│   └── puppet
│       ├── parser
│       ├── provider
│       └── type
├── manifests
│   ├── init.pp      &lt;!-- monmodule                 --&gt;
│   ├── maclasse.pp  &lt;!-- monmodule::maclasse       --&gt;
│   ├── montype.pp   &lt;!-- monmodule::montype        --&gt;
│   └── montype
│       └── autre.pp &lt;!-- monmodule::montype::autre --&gt;
├── Modulefile
├── spec / tests
└── templates
    └── httpd.conf.erb</code></pre>
                    </section>
				</section>

                <section>
                    <h2>Questions</h2>
                </section>

                <section>
                    <h2>Merci !</h2>

                    <div class="fragment" style="float: left; width: 45%; margin: 0 2.5%">
                        <img src="images/afup.jpg" style="width: 100%"/>
                        <h3>AFUP</h3>
                    </div>

                    <div class="fragment" style="float: left; width: 45%; margin: 0 2.5%">
                        <img src="images/afpy.png" style="width: 100%"/>
                        <h3>AFPY</h3>
                    </div>
        
                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                                keyboard: {
                                  39: 'next',
                                  37: 'prev'
                                },

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
